<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>üöÄ SEO Show Notes Generator MVP</title>
        <style>
            /* Hide elements by default */
            .hidden {
                display: none !important;
            }

            /* Base styles */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                line-height: 1.6;
                color: #333;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 800px;
                margin: 0 auto;
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            .header {
                text-align: center;
                margin-bottom: 30px;
            }

            .header h1 {
                color: #667eea;
                margin-bottom: 10px;
                font-size: 2.2em;
            }

            /* Form styles */
            .form-group {
                margin-bottom: 20px;
            }

            label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: #555;
            }

            textarea,
            select {
                width: 100%;
                padding: 12px;
                border: 2px solid #e1e5e9;
                border-radius: 8px;
                font-size: 16px;
                transition: border-color 0.3s;
            }

            textarea:focus,
            select:focus {
                outline: none;
                border-color: #667eea;
            }

            textarea {
                min-height: 120px;
                resize: vertical;
            }

            /* Button styles */
            .btn {
                display: inline-block;
                padding: 12px 24px;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                text-decoration: none;
                text-align: center;
            }

            .btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none !important;
            }

            .btn-primary {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
            }

            .btn-primary:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
            }

            .btn-secondary {
                background: #6c757d;
                color: white;
            }

            .btn-outline {
                background: transparent;
                border: 2px solid #667eea;
                color: #667eea;
            }

            .btn-outline:hover {
                background: #667eea;
                color: white;
            }

            /* Usage display styles */
            .usage-display {
                padding: 12px;
                border-radius: 8px;
                margin-bottom: 20px;
                font-weight: 600;
                text-align: center;
            }

            .usage-display.warning {
                background: #fff3cd;
                color: #856404;
                border: 1px solid #ffeaa7;
            }

            .usage-display.premium {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
            }

            .usage-display.normal {
                background: #d1ecf1;
                color: #0c5460;
                border: 1px solid #bee5eb;
            }

            /* Action buttons */
            .action-buttons {
                display: flex;
                gap: 10px;
                justify-content: center;
                flex-wrap: wrap;
                margin-bottom: 30px;
            }

            /* Output styles */
            #output {
                margin-top: 30px;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 8px;
                border: 1px solid #e9ecef;
            }

            /* Modal styles */
            .upgrade-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            }

            .modal-content,
            .upgrade-content {
                background: white;
                padding: 30px;
                border-radius: 15px;
                max-width: 500px;
                width: 90%;
                text-align: center;
            }

            .modal-buttons,
            .upgrade-options {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
                margin-top: 20px;
            }

            .error {
                background: #f8d7da;
                color: #721c24;
                padding: 15px;
                border-radius: 5px;
                border: 1px solid #f5c6cb;
                margin: 10px 0;
            }

            .loading {
                background: #d1ecf1;
                color: #0c5460;
                padding: 15px;
                border-radius: 5px;
                border: 1px solid #bee5eb;
            }

            @media (max-width: 600px) {
                .container {
                    padding: 20px;
                }
                .action-buttons {
                    flex-direction: column;
                }
                .modal-buttons,
                .upgrade-options {
                    flex-direction: column;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>üöÄ SEO Show Notes Generator MVP</h1>
                <p>
                    Transform your podcast transcripts into engaging show notes
                </p>
            </div>

            <!-- Main Form -->
            <div id="main-app">
                <div class="form-group">
                    <label for="transcript">Paste your transcript here:</label>
                    <textarea
                        id="transcript"
                        placeholder="Paste your podcast transcript here..."
                    ></textarea>
                </div>

                <div class="form-group">
                    <label for="tone">Tone:</label>
                    <select id="tone">
                        <option value="casual">Casual</option>
                        <option value="formal">Formal</option>
                        <option value="witty">Witty</option>
                        <option value="professional">Professional</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="contentType">Content Type:</label>
                    <select id="contentType">
                        <option value="show-notes">
                            üìù Enhanced Show Notes
                        </option>
                        <option value="social">üì± Social Media Content</option>
                    </select>
                </div>

                <!-- Usage Display -->
                <div id="usage-display" class="usage-display normal">
                    5 free generations remaining this month
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button
                        id="generateBtn"
                        class="btn btn-primary"
                        onclick="generateShowNotes()"
                    >
                        Generate Show Notes
                    </button>
                    <button class="btn btn-outline" onclick="testConnection()">
                        üîç Test Connection
                    </button>
                    <button class="btn btn-outline" onclick="loadSample()">
                        üìù Load Sample
                    </button>
                </div>

                <!-- Output Area -->
                <div id="output">
                    <p>
                        üëÜ Enter your transcript and click "Generate Show Notes"!
                    </p>
                </div>
            </div>
        </div>

        <script>
            // Simple Usage Tracker - Using memory storage for demo
            class UsageTracker {
                constructor() {
                    this.freeLimit = 5;
                    this.usage = {
                        count: 0,
                        month: new Date().getMonth(),
                        year: new Date().getFullYear(),
                        isPaid: false,
                    };
                }

                getCurrentUsage() {
                    return this.usage;
                }

                canGenerate() {
                    return (
                        this.usage.isPaid || this.usage.count < this.freeLimit
                    );
                }

                getRemainingGenerations() {
                    if (this.usage.isPaid) return "Unlimited";
                    return Math.max(0, this.freeLimit - this.usage.count);
                }

                recordGeneration() {
                    const currentMonth = new Date().getMonth();
                    const currentYear = new Date().getFullYear();

                    // Reset if new month
                    if (
                        this.usage.month !== currentMonth ||
                        this.usage.year !== currentYear
                    ) {
                        this.usage = {
                            count: 0,
                            month: currentMonth,
                            year: currentYear,
                            isPaid: this.usage.isPaid || false,
                        };
                    }

                    this.usage.count++;
                    return this.usage;
                }
            }

            // Initialize
            const usageTracker = new UsageTracker();
            console.log("‚úÖ Script loaded successfully!");

            // Get API URL - now automatically detects local server
            function getApiUrl() {
                // For local development, use localhost
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    return 'http://localhost:3000';
                }
                // For production, use current origin
                return window.location.origin;
            }

            // Update usage display
            function updateUsageDisplay() {
                const remaining = usageTracker.getRemainingGenerations();
                const usageEl = document.getElementById("usage-display");

                if (remaining === "Unlimited") {
                    usageEl.innerHTML = "‚ú® Unlimited generations";
                    usageEl.className = "usage-display premium";
                } else {
                    usageEl.innerHTML = `${remaining} free generations remaining this month`;
                    usageEl.className =
                        remaining <= 2
                            ? "usage-display warning"
                            : "usage-display normal";
                }
            }

            // Test connection to server
            async function testConnection() {
                console.log("Testing connection...");
                const outputDiv = document.getElementById("output");

                try {
                    const API_URL = getApiUrl();
                    outputDiv.innerHTML =
                        "<div class='loading'>üîÑ Testing server connection...</div>";

                    const response = await fetch(`${API_URL}/api/test`);

                    console.log("Response status:", response.status);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log("Test successful:", data);

                    outputDiv.innerHTML = `
                        <div>
                            <h3>‚úÖ Server Connection Test Results:</h3>
                            <p><strong>Status:</strong> ${data.success ? "Working" : "Failed"}</p>
                            <p><strong>Message:</strong> ${data.message || "Connected successfully"}</p>
                            <p><strong>OpenAI:</strong> ${data.openai_configured ? "Configured ‚úÖ" : "Not configured ‚ùå"}</p>
                            <p><strong>Stripe:</strong> ${data.stripe_configured ? "Configured ‚úÖ" : "Not configured ‚ùå"}</p>
                            <p><strong>Timestamp:</strong> ${data.timestamp || new Date().toISOString()}</p>
                        </div>
                    `;
                } catch (error) {
                    console.error("Test failed:", error);
                    outputDiv.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Connection Test Failed</h3>
                            <p><strong>Error:</strong> ${error.message}</p>
                            <p><strong>Troubleshooting:</strong></p>
                            <ul>
                                <li>Make sure your Node.js server is running</li>
                                <li>Start it with: <code>node server.js</code></li>
                                <li>Check that it's accessible at ${getApiUrl()}</li>
                            </ul>
                        </div>
                    `;
                }
            }

            // Load sample transcript
            function loadSample() {
                console.log("Loading sample...");
                const sampleText = `Welcome to the Indie Creator Podcast! Today we're talking about building your first online business. Many creators struggle with monetization, but the key is starting small and focusing on one revenue stream. I've helped hundreds of creators go from zero to their first thousand dollars in revenue. The biggest mistake I see is trying to do everything at once instead of mastering one thing first. Today I'll share three specific strategies that work for any creator, regardless of your niche.`;

                document.getElementById("transcript").value = sampleText;
                document.getElementById("output").innerHTML =
                    "‚úÖ Sample transcript loaded! Now click Generate Show Notes.";
            }

            // Generate show notes function
            async function generateShowNotes() {
                console.log("ü§ñ Starting show notes generation...");

                // Check usage limits
                if (!usageTracker.canGenerate()) {
                    showUpgradeModal();
                    return;
                }

                const transcript = document.getElementById("transcript").value;
                const tone = document.getElementById("tone").value || "casual";
                const contentType =
                    document.getElementById("contentType").value ||
                    "show-notes";
                const generateButton = document.getElementById("generateBtn");
                const outputDiv = document.getElementById("output");

                // Validation
                if (!transcript.trim()) {
                    outputDiv.innerHTML =
                        "<div class='error'>‚ùå Please enter a transcript</div>";
                    return;
                }

                if (transcript.trim().length < 10) {
                    outputDiv.innerHTML =
                        "<div class='error'>‚ùå Please enter a longer transcript (at least 10 characters)</div>";
                    return;
                }

                try {
                    const API_URL = getApiUrl();

                    // Show loading state
                    generateButton.disabled = true;
                    generateButton.textContent = "Generating...";
                    outputDiv.innerHTML =
                        "<div class='loading'>ü§ñ Generating your show notes... Please wait!</div>";

                    console.log("Making API request to:", `${API_URL}/api/generate`);

                    // Call your show notes generation endpoint
                    const response = await fetch(`${API_URL}/api/generate`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            transcript: transcript,
                            tone: tone,
                            contentType: contentType
                        }),
                    });

                    console.log("Response status:", response.status);

                    if (response.ok) {
                        const data = await response.json();

                        if (data.success) {
                            // Record the generation and update usage display
                            const usage = usageTracker.recordGeneration();
                            updateUsageDisplay();

                            // Display the generated content
                            outputDiv.innerHTML = `
                                <div class="result">
                                    <h3>‚úÖ Generated Show Notes:</h3>
                                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #667eea;">
                                        <pre style="white-space: pre-wrap; font-family: inherit; line-height: 1.6; margin: 0;">${data.content}</pre>
                                    </div>
                                    <small style="color: #666;">Tokens used: ${data.usage?.total_tokens || "N/A"}</small>
                                </div>
                            `;
                        } else {
                            throw new Error(data.error || "Unknown error occurred");
                        }
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Server responded with status ${response.status}`);
                    }

                } catch (error) {
                    console.error("Generation failed:", error);
                    outputDiv.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Server Connection Failed</h3>
                            <p><strong>Error:</strong> ${error.message}</p>
                            <p><strong>Make sure:</strong></p>
                            <ul>
                                <li>Your Node.js server is running on port 3000</li>
                                <li>You started it with: <code>node server.js</code></li>
                                <li>The server is accessible at http://localhost:3000</li>
                            </ul>
                            <p><small>Check the console (F12) for more details.</small></p>
                        </div>
                    `;
                } finally {
                    // Reset button
                    generateButton.disabled = false;
                    generateButton.textContent = "Generate Show Notes";
                }
            }

            // Upgrade modal
            function showUpgradeModal() {
                const modal = document.createElement("div");
                modal.className = "upgrade-modal";
                modal.innerHTML = `
                    <div class="modal-content">
                        <h3>üöÄ Ready to unlock unlimited show notes?</h3>
                        <p>You've used all 5 free generations this month! Upgrade to continue creating amazing content.</p>
                        <div class="modal-buttons">
                            <button class="btn btn-primary" onclick="subscribeTo('creator')">
                                Creator Plan - ‚Ç¨9/month
                            </button>
                            <button class="btn btn-secondary" onclick="subscribeTo('pro')">
                                Pro Plan - ‚Ç¨15/month
                            </button>
                            <button class="btn btn-outline" onclick="closeUpgradeModal()">
                                Maybe Later
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            function closeUpgradeModal() {
                const modal = document.querySelector(".upgrade-modal");
                if (modal) modal.remove();
            }

            // Subscription functions
            async function subscribeTo(plan) {
                console.log(`Subscribing to ${plan} plan...`);

                const priceIds = {
                    creator: 'price_creator_plan_id', // Replace with your actual Stripe price IDs
                    pro: 'price_pro_plan_id'
                };

                try {
                    const API_URL = getApiUrl();
                    const response = await fetch(`${API_URL}/api/create-subscription`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ plan: plan }),
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.checkout_url) {
                            window.location.href = data.checkout_url;
                            return;
                        }
                    }

                    throw new Error("Failed to create subscription");
                } catch (error) {
                    console.error("Subscription error:", error);
                    alert(`Error creating subscription: ${error.message}`);
                }
            }

            // Initialize on page load
            document.addEventListener("DOMContentLoaded", function () {
                console.log("DOM loaded");
                updateUsageDisplay();

                // Handle payment success/cancel
                const urlParams = new URLSearchParams(window.location.search);
                const sessionId = urlParams.get("session_id");

                if (sessionId) {
                    // Payment successful
                    usageTracker.usage.isPaid = true;
                    updateUsageDisplay();
                    alert("‚úÖ Payment successful! You now have unlimited generations.");
                }
            });
        <script src="/script.js" defer></script>
    </body>
</html>